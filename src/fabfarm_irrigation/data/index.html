<!DOCTYPE HTML>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- TODO: grab fontawesomes & server locally -->
    <link rel="stylesheet" type="text/css" href="all.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script language="javascript" src="serverDate.js"></script>
</head>
<script language="javascript">
    var localTime = new Date();
    document.write("Local machine time is: " + localTime + "<br>");
    document.write("Server time is: " + date);
    </script>
<body>

    <h2>Fab Farm Irrigation System</h2>
    <p><img src="logo.jpeg" style="height:400px;"/></p>
    
    <!-- TODO: we can replace placeholders with simple js -->
    <p>
        <i class="fas fa-clock"></i>
        <span class="dht-labels">Farm Time</span>
        <br>
        <span id="farmtimenow">%FARMTIMENOW%</span>
    </p>
    <hr>
    <!-- TODO: the buttons here can have onChange events that auto-calls back w/o needing a submit -->
    %BUTTONPLACEHOLDER%
    <hr>
    <p>
        <i class="fas fa-thermometer-half"></i>
        <span class="dht-labels">Temperature</span>
        <span id="temperature">%TEMPERATURE%</span>
        <sup class="units">&deg;C</sup>
    </p>
    <hr>
    <p>
        <i class="fas fa-tint"></i>
        <span class="dht-labels">Humidity</span>
        <span id="humidity">%HUMIDITY%</span>
        <sup class="units">%</sup>
    </p>

</body>
<script>

    // pint the server for new info every X seconds
    setInterval(function() {

        var r1 = new XMLHttpRequest();
        r1.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("farmtimenow").innerHTML = this.responseText;
            }
        };
        r1.open("GET", "/farmtimenow", true);
        r1.send();
        
        var r2 = new XMLHttpRequest();
        r2.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("temperature").innerHTML = this.responseText;
            }
        };
        r2.open("GET", "/temperature", true);
        r2.send();

        var r3 = new XMLHttpRequest();
        r3.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("humidity").innerHTML = this.responseText;
            }
        };
        r3.open("GET", "/humidity", true);
        r3.send();

        //TODO: change the above to make *1* request and get json back
        var r3 = new XMLHttpRequest();
        r3.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                //document.getElementById("getData").innerHTML = this.responseText;
                console.log("Got json", this.responseText);
            }
        };
        r3.open("GET", "/getData", true);
        r3.send();


    }, 10000);
      
    
    function toggleCheckbox(element) {
            var xhr = new XMLHttpRequest();
            if (element.checked) {
                xhr.open("GET", "/update?relay=" + element.id + "&state=1", true);
            } else {
                xhr.open("GET", "/update?relay=" + element.id + "&state=0", true);
            }
            xhr.send();
        }


</script>

</html>
